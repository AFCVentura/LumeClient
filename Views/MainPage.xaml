<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shell="clr-namespace:Microsoft.Maui.Controls;assembly=Microsoft.Maui.Controls"
shell:Shell.NavBarIsVisible="False"
NavigationPage.HasNavigationBar="False"
NavigationPage.HasBackButton="False"
             BackgroundColor="White"
             Title="MainPage"
             x:Class="LumeClient.Views.MainPage">

    <Grid RowDefinitions="Auto, Auto, Auto, *, Auto">

        <!-- TOPO -->
        <Grid Grid.Row="0" BackgroundColor="Black" Padding="10">
            <Image
                Source="lume_logo.png" 
                HorizontalOptions="Center" 
                HeightRequest="45" />
        </Grid>
        
        <!-- Título da seção -->
        <Grid Grid.Row="1" BackgroundColor="Black" Padding="10" Margin="0">
            <Label 
                Text="Suas Últimas recomendações"
                TextColor="{StaticResource Primary}"
                FontAttributes="Bold"
                FontSize="24"
                HorizontalOptions="Center"
                HorizontalTextAlignment="Center"/>
        </Grid>
        
        <!-- Carrossel / Wishlist -->
        <Grid RowDefinitions="Auto, *" Grid.Row="2" Padding="10,10,10,0">
            
            <!-- CollectionView para recomendações -->
            <CollectionView x:Name="RecommendationsCollection"
                ItemsLayout="HorizontalList"
                SelectionMode="Single"
                HeightRequest="170"
                Grid.Row="0"
                Margin="0,10">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <!-- Frame com tamanho fixo e sem padding interno -->
                        <Frame CornerRadius="8"
                            HasShadow="True"
                            HeightRequest="150"
                            WidthRequest="100"
                            Padding="0"
                            Margin="5"
                            BackgroundColor="Transparent">
                            <Grid>
                                <!-- placeholder -->
                                <Image 
                                    Source="poster_loading.png"
                                    Aspect="AspectFill"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill"
                                    InputTransparent="True"/>
                                <!-- poster real -->
                                <Image 
                                    Source="{Binding PosterPath}"
                                    Aspect="AspectFill"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill"
                                    InputTransparent="True"/>
                            </Grid>
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnRecommendationTapped" />
                            </Frame.GestureRecognizers>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Overlay de loading para o carrossel -->
            <Grid Grid.Row="0" x:Name="CarouselLoadingOverlay" BackgroundColor="#80000000" IsVisible="False">
                <ActivityIndicator IsRunning="True" Color="{StaticResource Primary}"
                                   HorizontalOptions="Center" VerticalOptions="Center"/>
            </Grid>
            <!-- Label quando não houver recomendações -->
            <Frame 
                x:Name="frameNoRecommendations"
                BorderColor="Transparent"
                Grid.Row="0" Grid.RowSpan="1"
                BackgroundColor="{StaticResource Secondary}" 
                CornerRadius="8"
                Padding="12"
                Margin="20"
                MinimumHeightRequest="450"
                HorizontalOptions="Center"
                VerticalOptions="Center">
                <VerticalStackLayout 
                    Spacing="6" 
                    HorizontalOptions="Center" 
                    VerticalOptions="Center">
                    <!-- Ícone de lâmpada, pode ser emoji ou FontImageSource -->
                    <ImageButton 
                        HeightRequest="60"
                        WidthRequest="60"
                        HorizontalOptions="Center" 
                        BackgroundColor="{StaticResource Primary}"
                        Grid.Column="1"
                        CornerRadius="30">
                        <ImageButton.Source>
                            <FontImageSource 
                                FontFamily="MaterialIcons"
                                Glyph="&#xe42e;"
                                Size="40"
                                Color="{StaticResource Tertiary}"
                            />
                        </ImageButton.Source>
                    </ImageButton>
                   

                    <!-- Título em negrito -->
                    <Label
                        Text="Ops! Nenhuma recomendação ainda."
                        FontSize="18"
                        FontAttributes="Bold"
                        TextColor="Black"
                        HorizontalTextAlignment="Center" />

                    <!-- Subtexto -->
                    <Label
                        Text="Toque na lâmpada abaixo para começar e descobrir filmes incríveis!"
                        FontSize="14"
                        TextColor="Black"
                        HorizontalTextAlignment="Center" />
                    <Image WidthRequest="80" HeightRequest="80">
                        <Image.Source>
                            <FontImageSource FontFamily="MaterialIcons"
                                 Glyph="&#xe5db;"
                                 Color="{StaticResource Primary}"/>
                        </Image.Source>
                    </Image>
                </VerticalStackLayout>
                <Frame.GestureRecognizers>
                    <!-- Se quiser que o usuário possa tocar no próprio frame para acionar a ação -->
                    <TapGestureRecognizer 
                        Command="{Binding Path=TapLampadaCommand}" />
                    <!-- Ou no code-behind use Tapped="OnPlayTapped" -->
                </Frame.GestureRecognizers>
            </Frame>
        </Grid>

        <!-- DETALHES DO FILME -->
        <ScrollView Grid.Row="3" Padding="20">
            <VerticalStackLayout x:Name="DetailsContainer" Spacing="10">
                <!-- Inicialmente vazio; será preenchido no code-behind -->
            </VerticalStackLayout>
        </ScrollView>

        <!-- MENU INFERIOR -->
        <Grid 
            Grid.Row="4" 
            Padding="30,10" 
            BackgroundColor="Black"
            >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Engrenagem -->
            <ImageButton 
                HeightRequest="60" 
                WidthRequest="60"
                HorizontalOptions="Center" 
                Grid.Column="0">
                <ImageButton.GestureRecognizers>
                    <TapGestureRecognizer 
                        Tapped="OnSettingsTapped" 
                        NumberOfTapsRequired="1" />
                </ImageButton.GestureRecognizers>
                
                <ImageButton.Source>
                    <FontImageSource 
                        FontFamily="MaterialIcons"
                        Glyph="&#xe8b8;"
                        Size="40"
                        Color="{StaticResource Primary}"/>
                </ImageButton.Source>
            </ImageButton>

            <!-- Lâmpada -->
            <ImageButton 
                HeightRequest="60"
                WidthRequest="60"
                HorizontalOptions="Center" 
                BackgroundColor="{StaticResource Primary}"
                Grid.Column="1"
                CornerRadius="30">
                <ImageButton.GestureRecognizers>
                    <TapGestureRecognizer 
                        Tapped="OnPlayTapped" 
                        NumberOfTapsRequired="1" />
                </ImageButton.GestureRecognizers>

                <ImageButton.Source>
                    <FontImageSource 
                        FontFamily="MaterialIcons"
                        Glyph="&#xe42e;"
                        Size="40"
                        Color="{StaticResource Tertiary}"
                        />
                </ImageButton.Source>
            </ImageButton>
            
            <!-- Coração -->
            <ImageButton 
                HeightRequest="60"
                WidthRequest="60"
                HorizontalOptions="Center" 
                Grid.Column="2">
                <ImageButton.GestureRecognizers>
                    <TapGestureRecognizer 
                        Tapped="OnWishlistTapped" 
                        NumberOfTapsRequired="1" />
                </ImageButton.GestureRecognizers>

                <ImageButton.Source>
                    <FontImageSource 
                        FontFamily="MaterialIcons"
                        Glyph="&#xe87d;"
                        Size="40"
                        Color="{StaticResource Primary}"/>
                </ImageButton.Source>
            </ImageButton>
        </Grid>
    </Grid>


</ContentPage>
